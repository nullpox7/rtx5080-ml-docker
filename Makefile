# RTX5080 GPU??? Makefile

.PHONY: help build up down restart logs shell gpu-test clean

# ??????????
help:
	@echo "RTX5080 GPU Docker?? ??????"
	@echo ""
	@echo "?????????:"
	@echo "  build       - Docker????????"
	@echo "  up          - ???????"
	@echo "  down        - ??????????"
	@echo "  restart     - ????????"
	@echo "  logs        - ?????"
	@echo "  shell       - ??????bash???"
	@echo "  gpu-test    - GPU????"
	@echo "  jupyter     - Jupyter Notebook??????????"
	@echo "  tensorboard - TensorBoard??????????"
	@echo "  clean       - ????????????????"
	@echo "  clean-all   - ???Docker ??????????"

# Docker????????
build:
	@echo "RTX5080?Docker?????????..."
	docker compose build --no-cache

# ???????
up:
	@echo "RTX5080 GPU??????..."
	docker compose up -d
	@echo "?????"
	@echo "Jupyter Notebook: http://localhost:8888"
	@echo "TensorBoard: http://localhost:6006"

# ??????????
down:
	@echo "????????..."
	docker compose down

# ????????
restart:
	@echo "?????????..."
	docker compose restart

# ?????
logs:
	docker compose logs -f

# ??????bash???
shell:
	docker compose exec gpu-ml-app bash

# GPU????
gpu-test:
	@echo "GPU?????..."
	docker compose exec gpu-ml-app python -c "import torch; print(f'CUDA available: {torch.cuda.is_available()}'); print(f'GPU count: {torch.cuda.device_count()}'); print(f'GPU name: {torch.cuda.get_device_name(0) if torch.cuda.is_available() else \"No GPU\"}'); print(f'CUDA version: {torch.version.cuda}' if torch.cuda.is_available() else 'No CUDA')"

# Jupyter Notebook??????
jupyter:
	@echo "Jupyter Notebook ??????:"
	@echo "URL: http://localhost:8888"
	@echo "????: ????????"

# TensorBoard??????  
tensorboard:
	@echo "TensorBoard ??????:"
	@echo "URL: http://localhost:6006"

# ?????????
clean:
	@echo "????Docker????????..."
	docker system prune -f
	docker volume prune -f

# ?Docker??????????
clean-all:
	@echo "??: ???Docker??????????"
	@read -p "??????? (y/N): " confirm && [ "$$confirm" = "y" ]
	docker system prune -a -f --volumes

# ???????
dev-setup:
	@echo "????????????..."
	mkdir -p src data models notebooks outputs logs
	@echo "???????????????:"
	@echo "  src/        - ??????"
	@echo "  data/       - ???????"  
	@echo "  models/     - ???????"
	@echo "  notebooks/  - Jupyter Notebook"
	@echo "  outputs/    - ????"
	@echo "  logs/       - ??????"

# ???????
update-packages:
	@echo "Python?????????..."
	docker compose exec gpu-ml-app pip install --upgrade pip
	docker compose exec gpu-ml-app pip install --upgrade -r requirements.txt
